<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>dd-vault-ingest</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Manual";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> dd-vault-ingest
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href=".">Manual</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#synopsis">SYNOPSIS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#description">DESCRIPTION</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#ingest-areas">Ingest areas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#processing-of-a-deposit">Processing of a deposit</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#order-of-deposit-processing">Order of deposit processing</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#processing-steps">Processing steps</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#arguments">ARGUMENTS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installation-and-configuration">INSTALLATION AND CONFIGURATION</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#building-from-source">BUILDING FROM SOURCE</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="dev/">Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="arch/">â‡’ DANS Data Station Architecture</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">dd-vault-ingest</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>Manual</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/DANS-KNAW/dd-vault-ingest/edit/master/docs/index.md"> Edit on DANS-KNAW/dd-vault-ingest</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="dd-vault-ingest">dd-vault-ingest<a class="headerlink" href="#dd-vault-ingest" title="Permanent link">&para;</a></h1>
<p>Service that processes deposits converting them to RDA compliant bags and sends them to the vault.</p>
<h2 id="synopsis">SYNOPSIS<a class="headerlink" href="#synopsis" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code>dd-vault-ingest { server | check }
</code></pre>

<h2 id="description">DESCRIPTION<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>This service is part of the DANS Vault Service. It is responsible for processing deposits, converting them to <a href="https://www.rd-alliance.org/system/files/Research%20Data%20Repository%20Interoperability%20WG%20-%20Final%20Recommendations_reviewed_0.pdf" target="_blank">RDA compliant bags</a>
and sending them to the DANS Data Vault. This service resembles <a href="https://dans-knaw.github.io/dd-ingest-flow/" target="_blank">dd-ingest-flow</a> in that it processes deposits and that these deposits
eventually end up in the Vault. However, this service differs from dd-ingest-flow in that it does not create a Dataverse dataset version for each deposit,
relying on Dataverse to automatically export the dataset version to and RDA compliant bag. Instead, this service creates the RDA compliant bag directly from the
deposit. That said, the resulting bag is still designed to closely resemble the Dataverse bag.</p>
<h3 id="ingest-areas">Ingest areas<a class="headerlink" href="#ingest-areas" title="Permanent link">&para;</a></h3>
<p>An ingest area is a directory on local disk storage that is used by the service to receive deposits. It contains the following subdirectories:</p>
<ul>
<li><code>inbox</code> - the directory under which all input deposits must be located</li>
<li><code>outbox</code> - a directory where the processed deposit are moved to (if successful to a subdirectory <code>processed</code>, otherwise to one of <code>rejected</code> or <code>failed</code>)</li>
</ul>
<p>The service currently supports only one ingest area: <code>auto-ingest</code> - for continuous import of deposits offered through deposit service, such as
<a href="https://dans-knaw.github.io/dd-sword2/" target="_blank">dd-sword2</a>.</p>
<h3 id="processing-of-a-deposit">Processing of a deposit<a class="headerlink" href="#processing-of-a-deposit" title="Permanent link">&para;</a></h3>
<h4 id="order-of-deposit-processing">Order of deposit processing<a class="headerlink" href="#order-of-deposit-processing" title="Permanent link">&para;</a></h4>
<p>A deposit directory represents one dataset version. The version history of a datasets is represented by a sequence of deposit directories. When enqueuing
deposits the program will first order them by the timestamp in the <code>Created</code> element in the contained bag's <code>bag-info.txt</code> file.</p>
<h4 id="processing-steps">Processing steps<a class="headerlink" href="#processing-steps" title="Permanent link">&para;</a></h4>
<p>The processing of a deposit consists of the following steps:</p>
<h5 id="basic-scenario">Basic scenario<a class="headerlink" href="#basic-scenario" title="Permanent link">&para;</a></h5>
<ol>
<li>Check that the deposit is a valid <a href="https://dans-knaw.github.io/dans-datastation-architecture/deposit-directory/" target="_blank">deposit directory</a>.</li>
<li>Check that the bag in the deposit is a valid v1 <a href="https://dans-knaw.github.io/dans-bagit-profile/versions/1.0.0/" target="_blank">DANS bag</a>.</li>
<li>Generate an NBN persistent identifier for the dataset and use that for the <code>dansNbn</code> field in the vault metadata.</li>
<li>Create a new, zipped RDA compliant bag from the deposit.</li>
<li>Register the bag in the dd-vault-catalog with minimal metadata: bag ID, NBN, and swordToken.</li>
<li>Move the deposit to the <code>outbox/processed</code> directory and change its state to <code>RECEIVED</code>.</li>
</ol>
<h6 id="update-scenario">Update scenario<a class="headerlink" href="#update-scenario" title="Permanent link">&para;</a></h6>
<p>2a Part of the validation will be to check that the deposit is an update to an existing dataset by checking that the <code>Is-Version-Of</code> field in the <code>bag-info.txt</code>
file of the deposit matches the <code>swordToken</code> of a dataset in the vault catalog.</p>
<p>3a Instead of generating a new NBN, the Vault Catalog will be queried for the NBN of the dataset that is being updated.</p>
<!-- todo:  
- link to metadata mapping spreadsheet
- how to validate that a user account is authorized to update a dataset?
-->

<h2 id="arguments">ARGUMENTS<a class="headerlink" href="#arguments" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code>    positional arguments:
    {server,check}         available commands

    named arguments:
    -h, --help             show this help message and exit
    -v, --version          show the application version and exit
</code></pre>

<h2 id="installation-and-configuration">INSTALLATION AND CONFIGURATION<a class="headerlink" href="#installation-and-configuration" title="Permanent link">&para;</a></h2>
<p>Currently, this project is built as an RPM package for RHEL7/CentOS7 and later. The RPM will install the binaries to
<code>/opt/dans.knaw.nl/dd-vault-ingest</code> and the configuration files to <code>/etc/opt/dans.knaw.nl/dd-vault-ingest</code>.</p>
<p>For installation on systems that do no support RPM and/or systemd:</p>
<ol>
<li>Build the tarball (see next section).</li>
<li>Extract it to some location on your system, for example <code>/opt/dans.knaw.nl/dd-vault-ingest</code>.</li>
<li>Start the service with the following command
   <code>/opt/dans.knaw.nl/dd-vault-ingest/bin/dd-vault-ingest server /opt/dans.knaw.nl/dd-vault-ingest/cfg/config.yml</code></li>
</ol>
<h2 id="building-from-source">BUILDING FROM SOURCE<a class="headerlink" href="#building-from-source" title="Permanent link">&para;</a></h2>
<p>Prerequisites:</p>
<ul>
<li>Java 11 or higher</li>
<li>Maven 3.3.3 or higher</li>
<li>RPM</li>
</ul>
<p>Steps:</p>
<pre class="codehilite"><code>git clone https://github.com/DANS-KNAW/dd-vault-ingest.git
cd dd-vault-ingest 
mvn clean install
</code></pre>

<p>If the <code>rpm</code> executable is found at <code>/usr/local/bin/rpm</code>, the build profile that includes the RPM
packaging will be activated. If <code>rpm</code> is available, but at a different path, then activate it by using
Maven's <code>-P</code> switch: <code>mvn -Pprm install</code>.</p>
<p>Alternatively, to build the tarball execute:</p>
<pre class="codehilite"><code>mvn clean install assembly:single
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="dev/" class="btn btn-neutral float-right" title="Development">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="dev/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.3.0
Build Date UTC : 2025-04-11 15:20:07.806794+00:00
-->
